Last updated: 2025-12-21

# Project Overview

## プロジェクト概要
- YM2151シンセサイザーのイベントログを編集するためのターミナルベースのJSONエディタです。
- イベントデータの可視化とタイミング調整、イベント検査に焦点を当てた機能を提供します。
- ユーザーはイベントの挿入、削除、待機時間設定といった基本的な編集と表示モード切り替えが可能です。

## 技術スタック
- フロントエンド: **ratatui** (0.29) - ターミナルユーザーインターフェース (TUI) フレームワークとして、リッチなターミナル画面の描画と管理を行います。**crossterm** (0.29) - ターミナルのバックエンドとして、キーイベントの処理やカーソル操作など、低レベルなターミナル制御を提供します。
- 音楽・オーディオ: (なし - プレビュー機能はありますが、オーディオ再生に特化した明示的なライブラリはプロジェクト情報に記述されていません。)
- 開発ツール: (なし - 明示的な開発支援ツールは記述されていませんが、Rustのエコシステムとして`cargo`が利用されます。)
- テスト: **Rust** (言語組み込みのテストフレームワーク) - ユニットテストの記述と実行に利用されます。
- ビルドツール: **cargo** - Rustの公式パッケージマネージャ兼ビルドシステムで、プロジェクトのビルド、テスト、依存関係管理を行います。
- 言語機能: **Rust** - 安全性、並行性、パフォーマンスに重点を置いたシステムプログラミング言語です。**serde** (1.0) と **serde_json** (1.0) も、JSONデータのシリアライズ/デシリアライズに利用されます。
- 自動化・CI/CD: (なし - 明示的なCI/CDツールは記述されていません。)
- 開発標準: (なし - 明示的なコード品質・統一ルール関連技術は記述されていません。)

## ファイル階層ツリー
```
.
├── .gitignore
├── Cargo.lock
├── Cargo.toml
├── IMPLEMENTATION_PLAN.md
├── LICENSE
├── README.ja.md
├── README.md
├── generated-docs/
├── googled947dc864c270e07.html
├── issue-notes/
│   ├── 19.md
│   ├── 20.md
│   └── 21.md
├── src/
│   ├── app.rs
│   ├── event_editor.rs
│   ├── file_io.rs
│   ├── main.rs
│   ├── models.rs
│   ├── navigation.rs
│   ├── preview.rs
│   ├── tests/
│   │   ├── app_tests.rs
│   │   └── mod.rs
│   ├── time_display.rs
│   └── ui.rs
└── test_data/
    ├── minimal.json
    └── sample.json
```

## ファイル詳細説明
- **`src/main.rs`**: アプリケーションのエントリーポイント。ターミナル環境の初期化、イベントループの実行、ユーザー入力の処理、アプリケーションの終了処理を担当します。
- **`src/app.rs`**: アプリケーションのメインロジックと状態管理を行います。YM2151イベントログデータ、UIモード、カーソル位置、現在の表示モード（累積時間/タイムスタンプ）などのアプリケーション全体の状態を保持し、ユーザー入力に応じて状態を更新します。
- **`src/models.rs`**: YM2151イベントログのデータ構造を定義します。具体的には、個々のYM2151イベント（`Ym2151Event`）と、それらのイベントのリストを含む全体ログ（`Ym2151Log`）の構造を定義し、JSONシリアライズ/デシリアライズ機能を提供します。
- **`src/ui.rs`**: `ratatui`フレームワークを使用して、アプリケーションの現在の状態をターミナルに描画するロジックをカプセル化します。イベントリスト、ヘッダー、フッター、カーソルなどのUI要素のレンダリングを行います。
- **`src/event_editor.rs`**: YM2151イベントログの編集に関するロジック（イベントの挿入、削除、待機時間の変更など）を管理します。
- **`src/file_io.rs`**: JSON形式のYM2151イベントログファイルの読み込みと保存に関する処理を行います。ファイルパスを受け取り、データをファイルシステムから読み書きします。
- **`src/navigation.rs`**: ターミナルUIにおけるカーソルの移動（上下移動など）や選択範囲の管理など、ナビゲーション関連のロジックを処理します。
- **`src/preview.rs`**: 「P」キーでのプレビュー再生機能に関連するロジックを実装します。具体的な再生方法はプロジェクト情報には詳細がありませんが、イベントログ全体を再生する機能を担います。
- **`src/time_display.rs`**: イベントログの時刻表示モード（累積時間または絶対タイムスタンプ）の切り替えと、それに応じた表示値の計算ロジックを管理します。
- **`src/tests/app_tests.rs`**: `src/app.rs`で定義されたアプリケーションロジックに対するユニットテストを含みます。
- **`src/tests/mod.rs`**: `src/tests`ディレクトリ内のテストモジュールをまとめる役割を果たします。
- **`Cargo.toml`**: Rustプロジェクトのマニフェストファイル。プロジェクトのメタデータ（名前、バージョンなど）、ビルド設定、および依存する外部クレート（ライブラリ）を定義します。
- **`Cargo.lock`**: `Cargo.toml`で指定された依存関係の正確なバージョンとハッシュ値を記録するファイル。これにより、異なる環境でもビルドの再現性が保証されます。
- **`.gitignore`**: Gitバージョン管理システムが追跡しないファイルやディレクトリのパターンを指定します。
- **`LICENSE`**: プロジェクトの配布条件と著作権に関するライセンス情報が記述されています。
- **`README.ja.md`**: プロジェクトの日本語での説明、機能、インストール方法、使用方法などが記載されたドキュメントです。
- **`README.md`**: プロジェクトの英語での説明、機能、インストール方法、使用方法などが記載されたドキュメントです。
- **`IMPLEMENTATION_PLAN.md`**: プロジェクトのより詳細な実装計画、今後のロードマップ、設計上の考慮事項などが記述されたドキュメントです。
- **`issue-notes/19.md`**, **`issue-notes/20.md`**, **`issue-notes/21.md`**: 特定の機能やバグ、設計に関する課題や検討事項を記録したメモファイルです。
- **`test_data/minimal.json`**, **`test_data/sample.json`**: アプリケーションのテストやデモンストレーションに使用される、YM2151イベントログのサンプルJSONデータファイルです。
- **`googled947dc864c270e07.html`**: Googleサービスによるサイト所有権確認のためのファイルです。プロジェクトの機能とは直接関係ありません。

## 関数詳細説明
- **`main`** (in `src/main.rs`)
    - 役割: アプリケーションの起動と基本的なライフサイクル管理を行うエントリーポイント関数です。
    - 引数: プログラム実行時に渡されるコマンドライン引数（例: 編集するJSONファイルのパス）。
    - 戻り値: アプリケーションの実行結果を示す値（通常は`Result<(), Box<dyn std::error::Error>>`）。
    - 機能: ターミナルを初期化し、`App`構造体のインスタンスを生成してメインのイベントループを実行し、アプリケーション終了時にターミナルを元の状態に戻します。
- **`App::new`** (in `src/app.rs`)
    - 役割: アプリケーションの初期状態を構築し、`App`構造体の新しいインスタンスを生成するコンストラクタです。
    - 引数: 起動時に読み込むJSONファイルのパスなど、アプリケーションの初期設定に必要な情報。
    - 戻り値: 初期化された`App`構造体のインスタンス。
    - 機能: 指定されたJSONファイルを読み込み、初期のイベントログデータを設定し、UIのカーソル位置や表示モードなどのデフォルト値を設定します。
- **`App::update`** (in `src/app.rs`)
    - 役割: ユーザーからの入力イベント（キーボード操作など）に基づいてアプリケーションの状態を更新するメソッドです。
    - 引数: `crossterm::event::Event`などのユーザー入力イベント。
    - 戻り値: アプリケーションの継続を示すフラグ（例: `bool`型で`true`なら継続、`false`なら終了）。
    - 機能: キー入力に応じてイベント間の移動、新しいイベントの挿入、既存イベントの削除、待機時間の設定、時刻表示モードの切り替え、ファイルの保存、アプリケーションの終了といったロジックを実行します。
- **`ui::draw`** (in `src/ui.rs`)
    - 役割: アプリケーションの現在の状態をターミナル画面に描画する関数です。
    - 引数: `&mut ratatui::Frame`（描画対象のフレーム）、`&App`（アプリケーションの現在の状態）。
    - 戻り値: なし。
    - 機能: `App`構造体に保持されているデータ（YM2151イベントログ、カーソル位置、表示モードなど）に基づき、`ratatui`クレートを使用してターミナル上に情報をレンダリングします。
- **`Ym2151Log::from_json`** (in `src/models.rs`)
    - 役割: JSON形式の文字列を解析し、`Ym2151Log`構造体のインスタンスにデシリアライズする関連関数です。
    - 引数: YM2151イベントログを表すJSON形式の文字列。
    - 戻り値: `Result<Ym2151Log, serde_json::Error>`（成功した場合は`Ym2151Log`、失敗した場合はエラー）。
    - 機能: ファイルから読み込まれたJSONデータをRustの内部データ構造に変換します。
- **`Ym2151Log::to_json`** (in `src/models.rs`)
    - 役割: `Ym2151Log`構造体のインスタンスをJSON形式の文字列にシリアライズするメソッドです。
    - 引数: なし（またはJSON出力のフォーマットオプション）。
    - 戻り値: `Result<String, serde_json::Error>`（成功した場合はJSON文字列、失敗した場合はエラー）。
    - 機能: 内部で保持しているイベントログデータを、ファイルに保存するためのJSON形式の文字列に変換します。
- **`file_io::read_json_file`** (in `src/file_io.rs`)
    - 役割: 指定されたファイルパスからJSONファイルの内容を読み込む関数です。
    - 引数: 読み込むファイルのパス (`&std::path::Path`)。
    - 戻り値: `Result<String, std::io::Error>`（成功した場合はファイル内容の文字列、失敗した場合はI/Oエラー）。
    - 機能: ファイルシステムからJSONデータを文字列として安全に読み出します。
- **`file_io::write_json_file`** (in `src/file_io.rs`)
    - 役割: 指定されたファイルパスにJSON形式の文字列を書き込む関数です。
    - 引数: 書き込むファイルのパス (`&std::path::Path`)、書き込むJSON文字列 (`&str`)。
    - 戻り値: `Result<(), std::io::Error>`（成功した場合はユニット値`()`、失敗した場合はI/Oエラー）。
    - 機能: 内部で編集されたJSONデータをファイルシステムに安全に保存します。

## 関数呼び出し階層ツリー
```
関数呼び出し階層を分析できませんでした

---
Generated at: 2025-12-21 07:04:28 JST
